<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx | èœ—èœ—ğŸ‡</title>
    <meta name="description" content="ä»é›¶å¼€å§‹ä¸€æ­¥ä¸€æ­¥é£™èµ·æ¥">
    <link rel="icon" href="/myIcon.ico">
    
    <link rel="preload" href="/assets/css/styles.c7e086f0.css" as="style"><link rel="preload" href="/assets/js/app.c7e086f0.js" as="script"><link rel="preload" href="/assets/js/6.2abe4e41.js" as="script"><link rel="prefetch" href="/assets/css/1.styles.68aee00d.css"><link rel="prefetch" href="/assets/css/2.styles.d1dddd6f.css"><link rel="prefetch" href="/assets/js/1.68aee00d.js"><link rel="prefetch" href="/assets/js/10.999d289c.js"><link rel="prefetch" href="/assets/js/11.82756d16.js"><link rel="prefetch" href="/assets/js/12.65cc639e.js"><link rel="prefetch" href="/assets/js/13.28310326.js"><link rel="prefetch" href="/assets/js/14.806859aa.js"><link rel="prefetch" href="/assets/js/15.18a18ef2.js"><link rel="prefetch" href="/assets/js/16.c0969d6b.js"><link rel="prefetch" href="/assets/js/17.21096078.js"><link rel="prefetch" href="/assets/js/18.5b4893c3.js"><link rel="prefetch" href="/assets/js/19.da070b39.js"><link rel="prefetch" href="/assets/js/2.d1dddd6f.js"><link rel="prefetch" href="/assets/js/3.bd510fb8.js"><link rel="prefetch" href="/assets/js/4.32fa4d48.js"><link rel="prefetch" href="/assets/js/5.30c1c9c0.js"><link rel="prefetch" href="/assets/js/7.0aac4afd.js"><link rel="prefetch" href="/assets/js/8.bb15a03e.js"><link rel="prefetch" href="/assets/js/9.c0befbf8.js">
    <link rel="stylesheet" href="/assets/css/styles.c7e086f0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      èœ—èœ—ğŸ‡
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">ä¸»é¡µ</a></div><div class="nav-item"><a href="/pages/resume/" class="nav-link">ä¸ªäººç®€å†</a></div><div class="nav-item"><a href="/pages/gits/" class="nav-link">git</a></div><div class="nav-item"><a href="/pages/javascript/" class="nav-link">jsé›†</a></div><div class="nav-item"><a href="/pages/macConfig/" class="nav-link">macé…ç½®å°çµ®</a></div><div class="nav-item"><a href="/pages/toSumUp/" class="nav-link">å°ç»“</a></div><div class="nav-item"><a href="/pages/backstage/" class="nav-link router-link-active">åç«¯</a></div><a href="https://github.com/hxl888" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">ä¸»é¡µ</a></div><div class="nav-item"><a href="/pages/resume/" class="nav-link">ä¸ªäººç®€å†</a></div><div class="nav-item"><a href="/pages/gits/" class="nav-link">git</a></div><div class="nav-item"><a href="/pages/javascript/" class="nav-link">jsé›†</a></div><div class="nav-item"><a href="/pages/macConfig/" class="nav-link">macé…ç½®å°çµ®</a></div><div class="nav-item"><a href="/pages/toSumUp/" class="nav-link">å°ç»“</a></div><div class="nav-item"><a href="/pages/backstage/" class="nav-link router-link-active">åç«¯</a></div><a href="https://github.com/hxl888" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav><ul class="sidebar-links"><li><a href="/pages/backstage/" aria-current="page" class="sidebar-link">â€” åç«¯ â€”</a></li><li><a href="/pages/backstage/nginx.html" aria-current="page" class="active sidebar-link">nginx</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/backstage/node.html" class="sidebar-link">nodejsç¬”è®°</a></li></ul></div><div class="page"><div class="content"><h1 id="nginx"><a href="#nginx" class="header-anchor">#</a> nginx</h1><h3 id="nginx-çš„å®‰è£…"><a href="#nginx-çš„å®‰è£…" class="header-anchor">#</a> nginx çš„å®‰è£…</h3><div class="language- extra-class"><pre class="language-text"><code>ä¸‹è½½åœ°å€: http://nginx.org/download/nginx-1.4.2.tar.gz
å®‰è£…å‡†å¤‡: nginxä¾èµ–äºpcreåº“,è¦å…ˆå®‰è£…pcre
yum install pcre pcre-devel
 cd /usr/local/src/
 wget http://nginx.org/download/nginx-1.4.2.tar.gz
tar zxvf nginx-1.4.2.tar.gz 
cd nginx-1.4.2
./configure --prefix=/usr/local/nginx
make &amp;&amp; make install

</code></pre></div><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="header-anchor">#</a> å¯åŠ¨:</h3><div class="language- extra-class"><pre class="language-text"><code>cd /ulsr/local/nginx, çœ‹åˆ°å¦‚ä¸‹4ä¸ªç›®å½•
./
 ....conf é…ç½®æ–‡ä»¶  
 ... html ç½‘é¡µæ–‡ä»¶
 ...logs  æ—¥å¿—æ–‡ä»¶ 
 ...sbin  ä¸»è¦äºŒè¿›åˆ¶ç¨‹åº

[root@localhost nginx]# ./sbin/nginx 
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
....
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] still could not bind()

</code></pre></div><p>ä¸èƒ½ç»‘å®š80ç«¯å£,80ç«¯å£å·²ç»è¢«å ç”¨
(æœ‰æ—¶æ˜¯è‡ªå·±è£…äº†apache,nginxç­‰,è¿˜æœ‰æ›´å¤šæƒ…å†µæ˜¯æ“ä½œç³»ç»Ÿè‡ªå¸¦äº†apacheå¹¶ä½œä¸ºæœåŠ¡å¯åŠ¨)
è§£å†³: æŠŠå ç”¨80ç«¯å£çš„è½¯ä»¶æˆ–æœåŠ¡å…³é—­å³å¯.</p><h3 id="nginxçš„ä¿¡å·æ§åˆ¶"><a href="#nginxçš„ä¿¡å·æ§åˆ¶" class="header-anchor">#</a> Nginxçš„ä¿¡å·æ§åˆ¶</h3><div class="language- extra-class"><pre class="language-text"><code>TERM, INT	Quick shutdown QUIT	Graceful shutdown  ä¼˜é›…çš„å…³é—­è¿›ç¨‹,å³ç­‰è¯·æ±‚ç»“æŸåå†å…³é—­ï¼›

HUP	Configuration reload ,Start the new worker processes with
 a new configuration Gracefully shutdown the old worker processes
 
æ”¹å˜é…ç½®æ–‡ä»¶,å¹³æ»‘çš„é‡è¯»é…ç½®æ–‡ä»¶:

USR1	Reopen the log files é‡è¯»æ—¥å¿—,åœ¨æ—¥å¿—æŒ‰æœˆ/æ—¥åˆ†å‰²æ—¶æœ‰ç”¨

USR2	Upgrade Executable on the fly å¹³æ»‘çš„å‡çº§

WINCH	Gracefully shutdown the worker processes ä¼˜é›…å…³é—­æ—§çš„è¿›ç¨‹(é…åˆUSR2æ¥è¿›è¡Œå‡çº§)


å…·ä½“è¯­æ³•:
Kill -ä¿¡å·é€‰é¡¹ nginxçš„ä¸»è¿›ç¨‹å·
Kill -HUP 4873

Kill -ä¿¡å·æ§åˆ¶ `cat /xxx/path/log/nginx.pid`

Kil; -USR1 `cat /xxx/path/log/nginx.pid`

</code></pre></div><h3 id="nginxé…ç½®æ®µ"><a href="#nginxé…ç½®æ®µ" class="header-anchor">#</a> Nginxé…ç½®æ®µ</h3><div class="language- extra-class"><pre class="language-text"><code>// å…¨å±€åŒº
worker_processes 1; // æœ‰1ä¸ªå·¥ä½œçš„å­è¿›ç¨‹,å¯ä»¥è‡ªè¡Œä¿®æ”¹,ä½†å¤ªå¤§æ— ç›Š,å› ä¸ºè¦äº‰å¤ºCPU,ä¸€èˆ¬è®¾ç½®ä¸º CPUæ•°*æ ¸æ•°

Event {
// ä¸€èˆ¬æ˜¯é…ç½®nginxè¿æ¥çš„ç‰¹æ€§
// å¦‚1ä¸ªwordèƒ½åŒæ—¶å…è®¸å¤šå°‘è¿æ¥
 worker_connections  1024; // è¿™æ˜¯æŒ‡ ä¸€ä¸ªå­è¿›ç¨‹æœ€å¤§å…è®¸è¿1024ä¸ªè¿æ¥
}

http {  //è¿™æ˜¯é…ç½®httpæœåŠ¡å™¨çš„ä¸»è¦æ®µ
     Server1 { // è¿™æ˜¯è™šæ‹Ÿä¸»æœºæ®µ
       
            Location {  //å®šä½,æŠŠç‰¹æ®Šçš„è·¯å¾„æˆ–æ–‡ä»¶å†æ¬¡å®šä½ ,å¦‚imageç›®å½•å•ç‹¬å¤„ç†
            }             /// å¦‚.phpå•ç‹¬å¤„ç†

     }

     Server2 {
     }
}


ä¾‹å­1: åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº

    server {
        listen 80;  #ç›‘å¬ç«¯å£
        server_name a.com; #ç›‘å¬åŸŸå

        location / {
                root /var/www/a.com;   #æ ¹ç›®å½•å®šä½
                index index.html;
        }
    }

ä¾‹å­2: åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœºé…ç½®

    server {
        listen 8080;
        server_name 192.168.1.204;

        location / {
                root /var/www/html8080;
                index index.html;
        }
    }
æ—¥å¿—ç®¡ç†


æˆ‘ä»¬è§‚å¯Ÿnginxçš„serveræ®µ,å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç±»ä¼¼ä¿¡æ¯
 #access_log  logs/host.access.log  main;
è¿™è¯´æ˜ è¯¥server, å®ƒçš„è®¿é—®æ—¥å¿—çš„æ–‡ä»¶æ˜¯  logs/host.access.log ,
ä½¿ç”¨çš„æ ¼å¼â€mainâ€æ ¼å¼.
é™¤äº†mainæ ¼å¼,ä½ å¯ä»¥è‡ªå®šä¹‰å…¶ä»–æ ¼å¼.

mainæ ¼å¼æ˜¯ä»€ä¹ˆ?
log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
    #                  '$status $body_bytes_sent &quot;$http_referer&quot; '
    #                  '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

mainæ ¼å¼æ˜¯æˆ‘ä»¬å®šä¹‰å¥½ä¸€ç§æ—¥å¿—çš„æ ¼å¼,å¹¶èµ·ä¸ªåå­—,ä¾¿äºå¼•ç”¨.
ä»¥ä¸Šé¢çš„ä¾‹å­, mainç±»å‹çš„æ—¥å¿—,è®°å½•çš„ remote_addr.... http_x_forwarded_forç­‰é€‰é¡¹.


1: æ—¥å¿—æ ¼å¼ æ˜¯æŒ‡è®°å½•å“ªäº›é€‰é¡¹
é»˜è®¤çš„æ—¥å¿—æ ¼å¼: main
     log_format  main  '$remote_addr - $remote_user [$time_local] &quot;$request&quot; '
                            '$status $body_bytes_sent &quot;$http_referer&quot; '
                            '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';

å¦‚é»˜è®¤çš„mainæ—¥å¿—æ ¼å¼,è®°å½•è¿™ä¹ˆå‡ é¡¹
è¿œç¨‹IP- è¿œç¨‹ç”¨æˆ·/ç”¨æˆ·æ—¶é—´ è¯·æ±‚æ–¹æ³•(å¦‚GET/POST) è¯·æ±‚ä½“bodyé•¿åº¦ refereræ¥æºä¿¡æ¯
http-user-agentç”¨æˆ·ä»£ç†/èœ˜è›› ,è¢«è½¬å‘çš„è¯·æ±‚çš„åŸå§‹IP

http_x_forwarded_for:åœ¨ç»è¿‡ä»£ç†æ—¶,ä»£ç†æŠŠä½ çš„æœ¬æ¥IPåŠ åœ¨æ­¤å¤´ä¿¡æ¯ä¸­,ä¼ è¾“ä½ çš„åŸå§‹IP



2: å£°æ˜ä¸€ä¸ªç‹¬ç‰¹çš„log_formatå¹¶å‘½å

    log_format  mylog '$remote_addr- &quot;$request&quot; '
                     '$status $body_bytes_sent &quot;$http_referer&quot; '
                        '&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;';
åœ¨ä¸‹é¢çš„server/location,æˆ‘ä»¬å°±å¯ä»¥å¼•ç”¨ mylog

åœ¨serveræ®µä¸­,è¿™æ ·æ¥å£°æ˜
Nginxå…è®¸é’ˆå¯¹ä¸åŒçš„serveråšä¸åŒçš„Log ,(æœ‰çš„webæœåŠ¡å™¨ä¸æ”¯æŒ,å¦‚lighttp)

access_log logs/access_8080.log mylog;   
å£°æ˜log   logä½ç½®          logæ ¼å¼;

å®é™…åº”ç”¨: shell+å®šæ—¶ä»»åŠ¡+nginxä¿¡å·ç®¡ç†,å®Œæˆæ—¥å¿—æŒ‰æ—¥æœŸå­˜å‚¨
åˆ†ææ€è·¯: 
å‡Œæ™¨00:00:01,æŠŠæ˜¨å¤©çš„æ—¥å¿—é‡å‘½å,æ”¾åœ¨ç›¸åº”çš„ç›®å½•ä¸‹
å†USR1ä¿¡æ¯å·æ§åˆ¶nginxé‡æ–°ç”Ÿæˆæ–°çš„æ—¥å¿—æ–‡ä»¶


</code></pre></div><h3 id="å…·ä½“è„šæœ¬"><a href="#å…·ä½“è„šæœ¬" class="header-anchor">#</a> å…·ä½“è„šæœ¬:</h3><div class="language- extra-class"><pre class="language-text"><code>#!/bin/bash
base_path='/usr/local/nginx/logs'
log_path=$(date -d yesterday +&quot;%Y%m&quot;)
day=$(date -d yesterday +&quot;%d&quot;)
mkdir -p $base_path/$log_path
mv $base_path/access.log $base_path/$log_path/access_$day.log
#echo $base_path/$log_path/access_$day.log
kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`


</code></pre></div><h3 id="å®šæ—¶ä»»åŠ¡"><a href="#å®šæ—¶ä»»åŠ¡" class="header-anchor">#</a> å®šæ—¶ä»»åŠ¡</h3><div class="language- extra-class"><pre class="language-text"><code>Crontab ç¼–è¾‘å®šæ—¶ä»»åŠ¡
01 00 * * * /xxx/path/b.sh  æ¯å¤©0æ—¶1åˆ†(å»ºè®®åœ¨02-04ç‚¹ä¹‹é—´,ç³»ç»Ÿè´Ÿè½½å°)

</code></pre></div><h3 id="location-è¯­æ³•"><a href="#location-è¯­æ³•" class="header-anchor">#</a> location è¯­æ³•</h3><div class="language- extra-class"><pre class="language-text"><code>location æœ‰â€å®šä½â€çš„æ„æ€, æ ¹æ®Uriæ¥è¿›è¡Œä¸åŒçš„å®šä½.
åœ¨è™šæ‹Ÿä¸»æœºçš„é…ç½®ä¸­,æ˜¯å¿…ä¸å¯å°‘çš„,locationå¯ä»¥æŠŠç½‘ç«™çš„ä¸åŒéƒ¨åˆ†,å®šä½åˆ°ä¸åŒçš„å¤„ç†æ–¹å¼ä¸Š.
æ¯”å¦‚, ç¢°åˆ°.php, å¦‚ä½•è°ƒç”¨PHPè§£é‡Šå™¨?  --è¿™æ—¶å°±éœ€è¦location
location çš„è¯­æ³•
location [=|~|~*|^~] patt {
}
ä¸­æ‹¬å·å¯ä»¥ä¸å†™ä»»ä½•å‚æ•°,æ­¤æ—¶ç§°ä¸ºä¸€èˆ¬åŒ¹é…
ä¹Ÿå¯ä»¥å†™å‚æ•°
å› æ­¤,å¤§ç±»å‹å¯ä»¥åˆ†ä¸º3ç§
location = patt {} [ç²¾å‡†åŒ¹é…]
location patt{}  [ä¸€èˆ¬åŒ¹é…]
location ~ patt{} [æ­£åˆ™åŒ¹é…]

</code></pre></div><h3 id="å¦‚ä½•å‘æŒ¥ä½œç”¨"><a href="#å¦‚ä½•å‘æŒ¥ä½œç”¨" class="header-anchor">#</a> å¦‚ä½•å‘æŒ¥ä½œç”¨?:</h3><p>é¦–å…ˆçœ‹æœ‰æ²¡æœ‰ç²¾å‡†åŒ¹é…,å¦‚æœæœ‰,åˆ™åœæ­¢åŒ¹é…è¿‡ç¨‹.</p><div class="language- extra-class"><pre class="language-text"><code>location = patt {
    config A
}
å¦‚æœ $uri == patt,åŒ¹é…æˆåŠŸï¼Œä½¿ç”¨configA
   location = / {
              root   /var/www/html/;
             index  index.htm index.html;
        }
         
  location / {
             root   /usr/local/nginx/html;
            index  index.html index.htm;
  }

å¦‚æœè®¿é—®ã€€ã€€http://xxx.com/
å®šä½æµç¨‹æ˜¯ã€€
1: ç²¾å‡†åŒ¹é…ä¸­ã€€â€/â€   ,å¾—åˆ°indexé¡µä¸ºã€€ã€€index.htm
2: å†æ¬¡è®¿é—® /index.htm , æ­¤æ¬¡å†…éƒ¨è½¬è·³uriå·²ç»æ˜¯â€/index.htmâ€ , 
æ ¹ç›®å½•ä¸º/usr/local/nginx/html
3: æœ€ç»ˆç»“æœ,è®¿é—®äº† /usr/local/nginx/html/index.htm

å†æ¥çœ‹,æ­£åˆ™ä¹Ÿæ¥å‚ä¸.
location / {
            root   /usr/local/nginx/html;
            index  index.html index.htm;
        }

location ~ image {
           root /var/www/image;
           index index.html;
}

å¦‚æœæˆ‘ä»¬è®¿é—®  http://xx.com/image/logo.png
æ­¤æ—¶, â€œ/â€ ä¸â€/image/logo.pngâ€ åŒ¹é…
åŒæ—¶,â€imageâ€æ­£åˆ™ ä¸â€image/logo.pngâ€ä¹Ÿèƒ½åŒ¹é…,è°å‘æŒ¥ä½œç”¨?
æ­£åˆ™è¡¨è¾¾å¼çš„æˆæœå°†ä¼šä½¿ç”¨.

å›¾ç‰‡çœŸæ­£ä¼šè®¿é—® /var/www/image/logo.png 

location / {
             root   /usr/local/nginx/html;
             index  index.html index.htm;
         }
 
location /foo {
            root /var/www/html;
             index index.html;
}
æˆ‘ä»¬è®¿é—® http://xxx.com/foo
 å¯¹äºuri â€œ/fooâ€,   ä¸¤ä¸ªlocationçš„patt,éƒ½èƒ½åŒ¹é…ä»–ä»¬
å³ â€˜/â€™èƒ½ä»å·¦å‰ç¼€åŒ¹é… â€˜/fooâ€™, â€˜/fooâ€™ä¹Ÿèƒ½å·¦å‰ç¼€åŒ¹é…â€™/fooâ€™,
æ­¤æ—¶, çœŸæ­£è®¿é—® /var/www/html/index.html 
åŸå› :â€™/fooâ€™åŒ¹é…çš„æ›´é•¿,å› æ­¤ä½¿ç”¨ä¹‹.;

</code></pre></div><h3 id="rewrite-é‡å†™"><a href="#rewrite-é‡å†™" class="header-anchor">#</a> rewrite é‡å†™</h3><div class="language- extra-class"><pre class="language-text"><code>é‡å†™ä¸­ç”¨åˆ°çš„æŒ‡ä»¤
if  (æ¡ä»¶) {}  è®¾å®šæ¡ä»¶,å†è¿›è¡Œé‡å†™ 
set #è®¾ç½®å˜é‡
return #è¿”å›çŠ¶æ€ç  
break #è·³å‡ºrewrite
rewrite #é‡å†™


If  è¯­æ³•æ ¼å¼
If ç©ºæ ¼ (æ¡ä»¶) {
    é‡å†™æ¨¡å¼
}

æ¡ä»¶åˆæ€ä¹ˆå†™?
ç­”:3ç§å†™æ³•
1: â€œ=â€æ¥åˆ¤æ–­ç›¸ç­‰, ç”¨äºå­—ç¬¦ä¸²æ¯”è¾ƒ
2: â€œ~â€ ç”¨æ­£åˆ™æ¥åŒ¹é…(æ­¤å¤„çš„æ­£åˆ™åŒºåˆ†å¤§å°å†™)
   ~* ä¸åŒºåˆ†å¤§å°å†™çš„æ­£åˆ™
3: -f -d -eæ¥åˆ¤æ–­æ˜¯å¦ä¸ºæ–‡ä»¶,ä¸ºç›®å½•,æ˜¯å¦å­˜åœ¨.

ä¾‹å­:

            if  ($remote_addr = 192.168.1.100) {
                return 403;
            }


 if ($http_user_agent ~ MSIE) {
                rewrite ^.*$ /ie.htm;
                break; #(ä¸breakä¼šå¾ªç¯é‡å®šå‘)
 }

             if (!-e $document_root$fastcgi_script_name) {
                rewrite ^.*$ /404.html break;
            } 
            æ³¨, æ­¤å¤„è¿˜è¦åŠ break,
ä»¥ xx.com/dsafsd.htmlè¿™ä¸ªä¸å­˜åœ¨é¡µé¢ä¸ºä¾‹,
æˆ‘ä»¬è§‚å¯Ÿè®¿é—®æ—¥å¿—, æ—¥å¿—ä¸­æ˜¾ç¤ºçš„è®¿é—®è·¯å¾„,ä¾ç„¶æ˜¯GET /dsafsd.html HTTP/1.1
æç¤º: æœåŠ¡å™¨å†…éƒ¨çš„rewriteå’Œ302è·³è½¬ä¸ä¸€æ ·. 
è·³è½¬çš„è¯URLéƒ½å˜äº†,å˜æˆé‡æ–°httpè¯·æ±‚404.html, è€Œå†…éƒ¨rewrite, ä¸Šä¸‹æ–‡æ²¡å˜,
å°±æ˜¯è¯´ fastcgi_script_name ä»ç„¶æ˜¯ dsafsd.html,å› æ­¤ ä¼šå¾ªç¯é‡å®šå‘.
set æ˜¯è®¾ç½®å˜é‡ç”¨çš„, å¯ä»¥ç”¨æ¥è¾¾åˆ°å¤šæ¡ä»¶åˆ¤æ–­æ—¶ä½œæ ‡å¿—ç”¨.
è¾¾åˆ°apacheä¸‹çš„ rewrite_conditionçš„æ•ˆæœ

å¦‚ä¸‹: åˆ¤æ–­IEå¹¶é‡å†™,ä¸”ä¸ç”¨break; æˆ‘ä»¬ç”¨setå˜é‡æ¥è¾¾åˆ°ç›®çš„
if ($http_user_agent ~* msie) {
                set $isie 1;
            }

            if ($fastcgi_script_name = ie.html) {
                set $isie 0;
            }

            if ($isie 1) {
                rewrite ^.*$ ie.html;
            }


</code></pre></div><h3 id="rewriteè¯­æ³•"><a href="#rewriteè¯­æ³•" class="header-anchor">#</a> Rewriteè¯­æ³•</h3><div class="language- extra-class"><pre class="language-text"><code>Rewrite æ­£åˆ™è¡¨è¾¾å¼  å®šå‘åçš„ä½ç½® æ¨¡å¼

Goods-3.html ----&gt;Goods.php?goods_id=3
goods-([\d]+)\.html ---&gt; goods.php?goods_id =$1  

location /ecshop {
index index.php;
rewrite goods-([\d]+)\.html$ /ecshop/goods.php?id=$1;
rewrite article-([\d]+)\.html$ /ecshop/article.php?id=$1;
rewrite category-(\d+)-b(\d+)\.html /ecshop/category.php?id=$1&amp;brand=$2;

rewrite category-(\d+)-b(\d+)-min(\d+)-max(\d+)-attr([\d\.]+)\.html /ecshop/category.php?id=$1&amp;brand=$2&amp;price_min=$3&amp;price_max=$4&amp;filter_attr=$5;

rewrite category-(\d+)-b(\d+)-min(\d+)-max(\d+)-attr([\d+\.])-(\d+)-([^-]+)-([^-]+)\.html /ecshop/category.php?id=$1&amp;brand=$2&amp;price_min=$3&amp;price_max=$4&amp;filter_attr=$5&amp;page=$6&amp;sort=$7&amp;order=$8;
}

æ³¨æ„:ç”¨urlé‡å†™æ—¶, æ­£åˆ™é‡Œå¦‚æœæœ‰â€{}â€,æ­£åˆ™è¦ç”¨åŒå¼•å·åŒ…èµ·æ¥

</code></pre></div><h3 id="ç½‘é¡µå†…å®¹çš„å‹ç¼©ç¼–ç ä¸ä¼ è¾“é€Ÿåº¦ä¼˜åŒ–"><a href="#ç½‘é¡µå†…å®¹çš„å‹ç¼©ç¼–ç ä¸ä¼ è¾“é€Ÿåº¦ä¼˜åŒ–" class="header-anchor">#</a> ç½‘é¡µå†…å®¹çš„å‹ç¼©ç¼–ç ä¸ä¼ è¾“é€Ÿåº¦ä¼˜åŒ–</h3><div class="language- extra-class"><pre class="language-text"><code>æˆ‘ä»¬è§‚å¯Ÿnews.163.comçš„å¤´ä¿¡æ¯
è¯·æ±‚:
Accept-Encoding:gzip,deflate,sdch
å“åº”:
Content-Encoding:gzip
Content-Length:36093
å†æŠŠé¡µé¢å¦å­˜ä¸‹æ¥,è§‚å¯Ÿ,çº¦10Wå­—èŠ‚,å®é™…ä¼ è¾“çš„36093å­—èŠ‚
åŸå› -------å°±åœ¨äºgzipå‹ç¼©ä¸Š.

åŸç†: 
æµè§ˆå™¨---è¯·æ±‚----&gt; å£°æ˜å¯ä»¥æ¥å— gzipå‹ç¼© æˆ– deflateå‹ç¼© æˆ–compress æˆ– sdchå‹ç¼©
ä»httpåè®®çš„è§’åº¦çœ‹--è¯·æ±‚å¤´ å£°æ˜ acceopt-encoding: gzip deflate sdch  (æ˜¯æŒ‡å‹ç¼©ç®—æ³•,å…¶ä¸­sdchæ˜¯googleå€¡å¯¼çš„ä¸€ç§å‹ç¼©æ–¹å¼,ç›®å‰æ”¯æŒçš„æœåŠ¡å™¨å°šä¸å¤š)
æœåŠ¡å™¨--&gt;å›åº”---æŠŠå†…å®¹ç”¨gzipæ–¹å¼å‹ç¼©----&gt;å‘ç»™æµè§ˆå™¨
æµè§ˆ&lt;-----è§£ç gzip-----æ¥æ”¶gzipå‹ç¼©å†…å®¹----

æ¨ç®—ä¸€ä¸‹èŠ‚çœçš„å¸¦å®½:
å‡è®¾ news.163.com  PV  2äº¿
2*10^8  *  9*10^4 å­—èŠ‚ == 
2*10^8 * 9 * 10^4  * 10^-9 = 12*K*G = 18T
èŠ‚çœçš„å¸¦å®½æ˜¯éå¸¸æƒŠäººçš„

gzipé…ç½®çš„å¸¸ç”¨å‚æ•°
gzip on|off;  #æ˜¯å¦å¼€å¯gzip
gzip_buffers 32 4K| 16 8K #ç¼“å†²(å‹ç¼©åœ¨å†…å­˜ä¸­ç¼“å†²å‡ å—? æ¯å—å¤šå¤§?)
gzip_comp_level [1-9] #æ¨è6 å‹ç¼©çº§åˆ«(çº§åˆ«è¶Šé«˜,å‹çš„è¶Šå°,è¶Šæµªè´¹CPUè®¡ç®—èµ„æº)
gzip_disable #æ­£åˆ™åŒ¹é…UA ä»€ä¹ˆæ ·çš„Uriä¸è¿›è¡Œgzip
gzip_min_length 200 # å¼€å§‹å‹ç¼©çš„æœ€å°é•¿åº¦(å†å°å°±ä¸è¦å‹ç¼©äº†,æ„ä¹‰ä¸åœ¨)
gzip_http_version 1.0|1.1 # å¼€å§‹å‹ç¼©çš„httpåè®®ç‰ˆæœ¬(å¯ä»¥ä¸è®¾ç½®,ç›®å‰å‡ ä¹å…¨æ˜¯1.1åè®®)
gzip_proxied          # è®¾ç½®è¯·æ±‚è€…ä»£ç†æœåŠ¡å™¨,è¯¥å¦‚ä½•ç¼“å­˜å†…å®¹
gzip_types text/plain  application/xml # å¯¹å“ªäº›ç±»å‹çš„æ–‡ä»¶ç”¨å‹ç¼© å¦‚txt,xml,html ,css
gzip_vary on|off  # æ˜¯å¦ä¼ è¾“gzipå‹ç¼©æ ‡å¿—


æ³¨æ„: 
å›¾ç‰‡/mp3è¿™æ ·çš„äºŒè¿›åˆ¶æ–‡ä»¶,ä¸å¿…å‹ç¼©
å› ä¸ºå‹ç¼©ç‡æ¯”è¾ƒå°, æ¯”å¦‚100-&gt;80å­—èŠ‚,è€Œä¸”å‹ç¼©ä¹Ÿæ˜¯è€—è´¹CPUèµ„æºçš„.
æ¯”è¾ƒå°çš„æ–‡ä»¶ä¸å¿…å‹ç¼©,
</code></pre></div><h3 id="nginxçš„ç¼“å­˜è®¾ç½®-æé«˜ç½‘ç«™æ€§èƒ½"><a href="#nginxçš„ç¼“å­˜è®¾ç½®-æé«˜ç½‘ç«™æ€§èƒ½" class="header-anchor">#</a> nginxçš„ç¼“å­˜è®¾ç½®  æé«˜ç½‘ç«™æ€§èƒ½</h3><div class="language- extra-class"><pre class="language-text"><code>å¯¹äºç½‘ç«™çš„å›¾ç‰‡,å°¤å…¶æ˜¯æ–°é—»ç«™, å›¾ç‰‡ä¸€æ—¦å‘å¸ƒ, æ”¹åŠ¨çš„å¯èƒ½æ˜¯éå¸¸å°çš„.æˆ‘ä»¬å¸Œæœ› èƒ½å¦åœ¨ç”¨æˆ·è®¿é—®ä¸€æ¬¡å, å›¾ç‰‡ç¼“å­˜åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ç«¯,ä¸”æ—¶é—´æ¯”è¾ƒé•¿çš„ç¼“å­˜.
å¯ä»¥, ç”¨åˆ° nginxçš„expiresè®¾ç½® .
nginxä¸­è®¾ç½®è¿‡æœŸæ—¶é—´,éå¸¸ç®€å•,
åœ¨locationæˆ–ifæ®µé‡Œ,æ¥å†™.
æ ¼å¼  expires 30s;
      expires 30m;
      expires 2h;
      expires 30d;
(æ³¨æ„:æœåŠ¡å™¨çš„æ—¥æœŸè¦å‡†ç¡®,å¦‚æœæœåŠ¡å™¨çš„æ—¥æœŸè½åäºå®é™…æ—¥æœŸ,å¯èƒ½å¯¼è‡´ç¼“å­˜å¤±æ•ˆ)
å¦: 304 ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„ç¼“å­˜æ‰‹æ®µ
åŸç†æ˜¯: æœåŠ¡å™¨å“åº”æ–‡ä»¶å†…å®¹æ˜¯,åŒæ—¶å“åº”etagæ ‡ç­¾(å†…å®¹çš„ç­¾å,å†…å®¹ä¸€å˜,ä»–ä¹Ÿå˜), å’Œ last_modified_since 2ä¸ªæ ‡ç­¾å€¼
æµè§ˆå™¨ä¸‹æ¬¡å»è¯·æ±‚æ—¶,å¤´ä¿¡æ¯å‘é€è¿™ä¸¤ä¸ªæ ‡ç­¾, æœåŠ¡å™¨æ£€æµ‹æ–‡ä»¶æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–,å¦‚æ— ,ç›´æ¥å¤´ä¿¡æ¯è¿”å› etag,last_modified_since
æµè§ˆå™¨çŸ¥é“å†…å®¹æ— æ”¹å˜,äºæ˜¯ç›´æ¥è°ƒç”¨æœ¬åœ°ç¼“å­˜.
è¿™ä¸ªè¿‡ç¨‹,ä¹Ÿè¯·æ±‚äº†æœåŠ¡å™¨,ä½†æ˜¯ä¼ ç€çš„å†…å®¹æå°‘.
å¯¹äºå˜åŒ–å‘¨æœŸè¾ƒçŸ­çš„,å¦‚é™æ€html,js,css,æ¯”è¾ƒé€‚äºç”¨è¿™ä¸ªæ–¹å¼
 
nginxåå‘ä»£ç†æœåŠ¡å™¨+è´Ÿè½½å‡è¡¡
ç”¨nginxåšåå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡éå¸¸ç®€å•,
æ”¯æŒä¸¤ä¸ªç”¨æ³• 1ä¸ªproxy, 1ä¸ªupstream,åˆ†åˆ«ç”¨æ¥åšåå‘ä»£ç†,å’Œè´Ÿè½½å‡è¡¡
ä»¥åå‘ä»£ç†ä¸ºä¾‹, nginxä¸è‡ªå·±å¤„ç†phpçš„ç›¸å…³è¯·æ±‚,è€Œæ˜¯æŠŠphpçš„ç›¸å…³è¯·æ±‚è½¬å‘ç»™apacheæ¥å¤„ç†.

</code></pre></div><p><img src="https://note.youdao.com/yws/api/personal/file/WEBa4c028483506641fd14ceae318bd5f30?method=download&shareKey=7e9bf161fc9724eff11c62276755db49" alt="nginx-æè¿°1"></p><div class="language- extra-class"><pre class="language-text"><code>---è¿™ä¸å°±æ˜¯ä¼ è¯´çš„â€åŠ¨é™åˆ†ç¦»â€,åŠ¨é™åˆ†ç¦»ä¸æ˜¯ä¸€ä¸ªä¸¥è°¨çš„è¯´æ³•,å«åå‘ä»£ç†æ¯”è¾ƒè§„èŒƒ.

åå‘ä»£ç†åç«¯å¦‚æœæœ‰å¤šå°æœåŠ¡å™¨,è‡ªç„¶å¯å½¢æˆè´Ÿè½½å‡è¡¡,
ä½†proxy_passå¦‚ä½•æŒ‡å‘å¤šå°æœåŠ¡å™¨?
æŠŠå¤šå°æœåŠ¡å™¨ç”¨ upstreamæŒ‡å®šç»‘å®šåœ¨ä¸€èµ·å¹¶èµ·ä¸ªç»„å,
ç„¶åproxy_passæŒ‡å‘è¯¥ç»„

é»˜è®¤çš„å‡è¡¡çš„ç®—æ³•å¾ˆç®€å•,å°±æ˜¯é’ˆå¯¹åç«¯æœåŠ¡å™¨çš„é¡ºåº,é€ä¸ªè¯·æ±‚.
ä¹Ÿæœ‰å…¶ä»–è´Ÿè½½å‡è¡¡ç®—æ³•,å¦‚ä¸€è‡´æ€§å“ˆå¸Œ,éœ€è¦å®‰è£…ç¬¬3æ–¹æ¨¡å—.

</code></pre></div><h3 id="nginxå…·ä½“çš„å‹ç¼©é…ç½®"><a href="#nginxå…·ä½“çš„å‹ç¼©é…ç½®" class="header-anchor">#</a> Nginxå…·ä½“çš„å‹ç¼©é…ç½®</h3><div class="language- extra-class"><pre class="language-text"><code>å¸¸ç”¨ä»¥ä¸‹é…ç½®
gzip on|off
gzip_buffers 4K|8K ç¼“å†²(å’Œç¡¬ç›˜å—ç›¸å½“)
gzip_comp_level [1-9] æ¨è6
gzip_disable æ­£åˆ™åŒ¹é…å¦‚User-Agent,é’ˆå¯¹å¤è€æµè§ˆå™¨ä¸å‹ç¼©
gzip_min_length 200
gzip_http_version 1.0|1.1
gzip_types text/plain , application/xml (å„mimeä¹‹é—´,ä¸€å®šè¦åŠ ç©ºæ ¼,ä¸æ˜¯é€—å·)
gzip_vary on|off

</code></pre></div><h3 id="varyçš„ä½œç”¨"><a href="#varyçš„ä½œç”¨" class="header-anchor">#</a> Varyçš„ä½œç”¨:</h3><p><img src="https://note.youdao.com/yws/api/personal/file/WEB8744484d9ae930366d52001737b6c3ad?method=download&shareKey=81b2490f082f0a38b670ad8a8977bcb9" alt="Varyçš„ä½œç”¨"></p><h3 id="nginxå¯¹äºå›¾ç‰‡-jsç­‰é™æ€æ–‡ä»¶çš„ç¼“å­˜è®¾ç½®"><a href="#nginxå¯¹äºå›¾ç‰‡-jsç­‰é™æ€æ–‡ä»¶çš„ç¼“å­˜è®¾ç½®" class="header-anchor">#</a> Nginxå¯¹äºå›¾ç‰‡,jsç­‰é™æ€æ–‡ä»¶çš„ç¼“å­˜è®¾ç½®</h3><div class="language- extra-class"><pre class="language-text"><code>æ³¨:è¿™ä¸ªç¼“å­˜æ˜¯æŒ‡é’ˆå¯¹æµè§ˆå™¨æ‰€åšçš„ç¼“å­˜,ä¸æ˜¯æŒ‡æœåŠ¡å™¨ç«¯çš„æ•°æ®ç¼“å­˜.

ä¸»è¦çŸ¥è¯†ç‚¹: location expiresæŒ‡ä»¤

        location ~ \.(jpg|jpeg|png|gif)$ {
            expires 1d;
        }
        location ~ \.js$ {
           expires 1h;
        }

è®¾ç½®å¹¶è½½å…¥æ–°é…ç½®æ–‡ä»¶,ç”¨firebugè§‚å¯Ÿ,
ä¼šå‘ç° å›¾ç‰‡å†…å®¹,æ²¡æœ‰å†æ¬¡äº§ç”Ÿæ–°çš„è¯·æ±‚,åŸå› --åˆ©ç”¨äº†æœ¬åœ°ç¼“å­˜çš„æ•ˆæœ.


æ³¨: åœ¨å¤§å‹çš„æ–°é—»ç«™,æˆ–æ–‡ç« ç«™ä¸­,å›¾ç‰‡å˜åŠ¨çš„å¯èƒ½æ€§å¾ˆå°,å»ºè®®åš1å‘¨å·¦å³çš„ç¼“å­˜
Js,cssç­‰å°æ—¶çº§çš„ç¼“å­˜.


å¦‚æœä¿¡æ¯æµåŠ¨æ¯”è¾ƒå¿«,ä¹Ÿå¯ä»¥ä¸ç”¨expiresæŒ‡ä»¤,
ç”¨last_modified, etagåŠŸèƒ½(ä¸»æµçš„webæœåŠ¡å™¨éƒ½æ”¯æŒè¿™2ä¸ªå¤´ä¿¡æ¯)
åŸç†æ˜¯:
å“åº”: è®¡ç®—å“åº”å†…å®¹çš„ç­¾å, etag å’Œ ä¸Šæ¬¡ä¿®æ”¹æ—¶é—´
è¯·æ±‚: å‘é€ etatg, If-Modified-Since å¤´ä¿¡æ¯.
æœåŠ¡å™¨æ”¶åˆ°å,åˆ¤æ–­etagæ˜¯å¦ä¸€è‡´, æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¦å¤§äºif-Modifiled-Since 
å¦‚æœç›‘æµ‹åˆ°æœåŠ¡å™¨çš„å†…å®¹æœ‰å˜åŒ–,åˆ™è¿”å›304,
æµè§ˆå™¨å°±çŸ¥é“,å†…å®¹æ²¡å˜,ç›´æ¥ç”¨ç¼“å­˜.


304 æ¯”èµ·ä¸Šé¢çš„expires æŒ‡ä»¤
å¤šäº†1æ¬¡è¯·æ±‚,
ä½†æ˜¯æ¯”200çŠ¶æ€,å°‘äº†ä¼ è¾“å†…å®¹.

</code></pre></div><h3 id="nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡"><a href="#nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡" class="header-anchor">#</a> Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡</h3><p>æ­£å‘ä»£ç†</p><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf56a924e638a710b9bd3a4a15623a47e?method=download&shareKey=91ca14d1c16ef6577f58e00fadc49b5d" alt="Nginxåå‘ä»£ç†ä¸è´Ÿè½½å‡è¡¡æ­£å‘ä»£ç†"></p><div class="language- extra-class"><pre class="language-text"><code>å…·ä½“çš„è´Ÿè½½å‡è¡¡çš„æ–¹å¼
æ³¨æ„:è´Ÿè½½å‡è¡¡æ˜¯ä¸€ç§æ–¹æ¡ˆ,å®ç°åŠæ³•æœ‰DNSè½®è¯¢,
å¦‚ä¸‹å›¾,DNSæœåŠ¡å™¨å…è®¸ä¸€ä¸ªåŸŸåæœ‰å¤šä¸ªAè®°å½•,
é‚£ä¹ˆåœ¨ç”¨æˆ·è®¿é—®æ—¶,ä¸€èˆ¬æŒ‰åœ°åŸŸè¿”å›ä¸€ä¸ªè¾ƒè¿‘çš„è§£æè®°å½•.
è¿™æ ·,å…¨å›½ä¸åŒçš„åœ°åŒºçš„ç”¨æˆ·,çœ‹åˆ°çš„163çš„ä¸»é¡µ,æ¥è‡ªä¸åŒçš„æœåŠ¡å™¨.


ç¬¬äºŒæ­¥: å½“ è§£æå‡ºç»“æœ,æ¯”å¦‚æµè§ˆå™¨è¿æ¥60.217æ—¶,
è¿™å°ä¸»æœºåé¢è¿˜æœ‰Nå°,ä¹Ÿè¦åšè´Ÿè½½å‡è¡¡.

1: ç¡¬ä»¶ä¸Šåšè´Ÿè½½å‡è¡¡, F5 BIG-IP ,ç¡¬ä»¶è´Ÿè½½å‡è¡¡(å¾ˆè´µ).
ç›´æ¥ä»TCP/IPçš„åº•å±‚åè®®ä¸Š,ç›´æ¥åšæ•°æ®åŒ…çš„ä¸­è½¬.
2: è½¯ä»¶è´Ÿè½½å‡è¡¡, LVS 
3: åå‘ä»£ç†+è´Ÿè½½å‡è¡¡


</code></pre></div><h3 id="nginxåå‘ä»£ç†è®¾ç½®"><a href="#nginxåå‘ä»£ç†è®¾ç½®" class="header-anchor">#</a> Nginxåå‘ä»£ç†è®¾ç½®</h3><div class="language- extra-class"><pre class="language-text"><code>ä¾‹: æŠŠå›¾ç‰‡é‡å†™åˆ° 8080ç«¯å£(æ—¢ç„¶èƒ½å†™åˆ°8080ç«¯å£,å°±æ„å‘³ç€å¯ä»¥å†™åˆ°å…¶ä»–ç‹¬ç«‹æœåŠ¡å™¨ä¸Š)
        location ~ \.(jpg|jpeg|png|gif)$ {
                proxy_pass http://192.168.1.204:8080;
                expires 1d;
        }

é›†ç¾¤ä¸å‡è¡¡-----å¦‚æœåç«¯çš„æœåŠ¡å™¨éå¸¸å¤š,è¯¥å¦‚ä½•å†™? åˆå¦‚ä½•å‡åŒ€çš„åˆ†å‘ä»»åŠ¡

</code></pre></div><h3 id="nginx-ä¸memcachedçš„ç»„åˆ"><a href="#nginx-ä¸memcachedçš„ç»„åˆ" class="header-anchor">#</a> nginx ä¸memcachedçš„ç»„åˆ</h3><div class="language- extra-class"><pre class="language-text"><code>ç”¨æ³•: nginxå“åº”è¯·æ±‚æ—¶,ç›´æ¥è¯·æ±‚memcached,
å¦‚æœæ²¡æœ‰ç›¸åº”çš„å†…å®¹,å†å›è°ƒPHPé¡µé¢,å»æŸ¥è¯¢database,å¹¶å†™å…¥memcached.

åˆ†æ: memcachedæ˜¯k/vå­˜å‚¨, key--&gt;value,
nginxè¯·æ±‚memecachedæ—¶,ç”¨ä»€ä¹ˆåškey?
ä¸€èˆ¬ç”¨ uri arg åškey,  å¦‚ /abc.php?id=3

</code></pre></div><h3 id="nginx-ç¬¬ä¸‰æ–¹æ¨¡å—çš„å®‰è£…"><a href="#nginx-ç¬¬ä¸‰æ–¹æ¨¡å—çš„å®‰è£…" class="header-anchor">#</a> Nginx ç¬¬ä¸‰æ–¹æ¨¡å—çš„å®‰è£…</h3><div class="language- extra-class"><pre class="language-text"><code>ä»¥ngx_http_php_memcache_standard_balancer-masterä¸ºä¾‹
1:è§£å‹ åˆ° path/ngx_module

é…ç½®:
./configure --prefix=/xxx/xxx --add_module=/path/ngx_module
ç¼–è¯‘ å®‰è£…
Make &amp;&amp; make instal

é…ç½®memcacheé›†ç¾¤

    upstream memserver {  æŠŠç”¨åˆ°çš„memcachedèŠ‚ç‚¹,å£°æ˜åœ¨ä¸€ä¸ªç»„é‡Œ
        hash_key $request_uri;  // hashè®¡ç®—æ—¶çš„ä¾æ®,ä»¥uriåšä¾æ®æ¥hash
        server localhost:11211;
        server localhost:11212;
    }
Locationé‡Œ

        location / {
           # root   html;
           set $memcached_key $uri;
           memcached_pass memserver;  // memserverä¸ºä¸Šé¢çš„memcacheèŠ‚ç‚¹çš„åç§°
           error_page 404 /writemem.php;
           index  index.php index.html index.htm;
        }

åœ¨nginxä¸­åšé›†ç¾¤ä¸è´Ÿè½½å‡è¡¡,æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„
Upstream {}æ¨¡å— æŠŠå¤šå°æœåŠ¡å™¨åŠ å…¥åˆ°ä¸€ä¸ªç»„
ç„¶å memcached_pass, fastcgi_pass, proxy_pass ==&gt; upstreamç»„

é»˜è®¤çš„è´Ÿè½½å‡è¡¡çš„ç®—æ³•:
æ˜¯è®¾ç½®è®¡æ•°å™¨,è½®æµè¯·æ±‚Nå°æœåŠ¡å™¨.
å¯ä»¥å®‰è£…ç¬¬3æ–¹æ¨¡å¼,æ¥åˆ©ç”¨uriåšhashç­‰ç­‰.

å¦‚http://wiki.nginx.org/NginxHttpUpstreamConsistentHash 
è¿™ä¸ªæ¨¡å—å°±æ˜¯ç”¨ä¸€è‡´æ€§hashæ¥è¯·æ±‚åç«¯ç»“èŠ‚,å¹¶ä¸”å…¶ç®—æ³•,ä¸PHPä¸­çš„memcacheæ¨¡å—çš„ä¸€è‡´æ€§hashç®—æ³•,å…¼å®¹.

</code></pre></div><h3 id="å®‰è£…è¯¥æ¨¡å—å"><a href="#å®‰è£…è¯¥æ¨¡å—å" class="header-anchor">#</a> å®‰è£…è¯¥æ¨¡å—å:</h3><div class="language- extra-class"><pre class="language-text"><code>Nginx.confä¸­

    upstream memserver {
        consistent_hash $request_uri;
        server localhost:11211;
        server localhost:11212;
    }

</code></pre></div></div><div class="page-edit"><!----><!----></div><div class="page-nav"><p class="inner"><span class="prev">
        â† <a href="/pages/backstage/" class="prev router-link-active">
          â€” åç«¯ â€”
        </a></span><span class="next"><a href="/pages/backstage/node.html">
          nodejsç¬”è®°
        </a> â†’
      </span></p></div></div></div></div>
    <script src="/assets/js/app.c7e086f0.js" defer></script><script src="/assets/js/6.2abe4e41.js" defer></script>
  </body>
</html>
